{% extends "shop/base.html" %}
{% load static %}

{% block content %}
 <main>
    <article>

      <!-- 
        - #HERO
      -->

    

<section class="section hero" style="background-image: url('{% static "shop/media/images/hero-banner.png" %}')">
  <div class="container">

    <h2 class="h1 hero-title">
      Nouvelle collections <strong>"Les plus grandes marques aux pieds du 237."</strong>
    </h2>

    <p class="hero-text">
      KmerShoes Store est la boutique en ligne dédiée aux passionnés de sneakers et de style.
       Retrouvez les plus grandes marques comme Nike, Adidas, Puma, Vans, et bien d'autres,
        à des prix compétitifs. Livraison rapide, service client réactif, et produits 100% 
        authentiques pour habiller vos pas avec confiance.
    </p>

    <button class="btn btn-primary">
      <span>Achetez maintenant</span>

      <ion-icon name="arrow-forward-outline" aria-hidden="true"></ion-icon>
    </button>

  </div>
</section>

<!-- 
  - #COLLECTION
-->

<section class="section collection">
  <div class="container">

    <ul class="collection-list has-scrollbar">

      <li>
        <div class="collection-card" style="background-image: url('{% static "shop/media/images/collection-1.jpg" %}')">
          <h3 class="h4 card-title">Collections pour hommes</h3>

          <a href="#" class="btn btn-secondary">
            <span>Explorer tout</span>

            <ion-icon name="arrow-forward-outline" aria-hidden="true"></ion-icon>
          </a>
        </div>
      </li>

      <li>
        <div class="collection-card" style="background-image: url('{% static "shop/media/images/collection-2.jpg" %}')">
          <h3 class="h4 card-title">Collections pour femmes</h3>

          <a href="#" class="btn btn-secondary">
            <span>Explorer tout</span>

            <ion-icon name="arrow-forward-outline" aria-hidden="true"></ion-icon>
          </a>
        </div>
      </li>

      <li>
        <div class="collection-card" style="background-image: url('{% static "shop/media/images/collection-3.jpg" %}')">
          <h3 class="h4 card-title">Collections de Sports</h3>

          <a href="#" class="btn btn-secondary">
            <span>Explorer tout</span>

            <ion-icon name="arrow-forward-outline" aria-hidden="true"></ion-icon>
          </a>
        </div>
      </li>

    </ul>

  </div>
</section>

<!-- 
  - #PRODUCT
-->

<section class="section product">
  <div class="container">

    <h2 class="h2 section-title">Produits best-sellers</h2>

    <ul class="filter-list">

      <li>
        <button class="filter-btn  active">Tout</button>
      </li>

      <li>
        <button class="filter-btn">Nike</button>
      </li>

      <li>
        <button class="filter-btn">Adidas</button>
      </li>

      <li>
        <button class="filter-btn">Puma</button>
      </li>

      <li>
        <button class="filter-btn">Bata</button>
      </li>

      <li>
        <button class="filter-btn">Apex</button>
      </li>

    </ul>

  
      
    
  <!-- 
  - #PRODUCT
  -->
  <ul class="product-list">
    
    {% for product in products %}
      <li class="product-item">
        <div class="product-card" tabindex="0">

          <figure class="card-banner">
            <img src="{{ product.image.url }}" width="312" height="350" loading="lazy"
              alt="{{ product.name }}" class="image-contain">
              {% if product.badge %}
                <div class="card-badge">{{ product.badge }}</div>
              {% endif %}

            <ul class="card-action-list">
              <li class="card-action-item">
                <a href="{% url 'add_to_cart' product.id %}" class="card-action-btn">
                  <ion-icon name="cart-outline"></ion-icon>
                </a>
                <div class="card-action-tooltip">Add to Cart</div>
              </li>
              <li class="card-action-item">
                <button class="card-action-btn" aria-label="Ajouter à la wishlist">
                  <ion-icon 
                    name="{% if user.is_authenticated and product.is_liked %}heart{% else %}heart-outline{% endif %}" 
                    style="{% if user.is_authenticated and product.is_liked %}color: red;{% endif %}">
                  </ion-icon>
                </button>
                <div class="card-action-tooltip">Add to Wishlist</div>
              </li>



              <li class="card-action-item">
                <a href="{% url 'product_detail' product.id %}" class="card-action-btn">
                  <ion-icon name="eye-outline"></ion-icon>
                </a>
                <div class="card-action-tooltip">Quick View</div>
              </li>
            </ul>
          </figure>

          <div class="card-content">
            <div class="card-cat">
              <span class="card-cat-link">{{ product.category }}</span>
            </div>

            <h3 class="h3 card-title">
              <a href="{% url 'product_detail' product.id %}">{{ product.name }}</a>
            </h3>

            <data class="card-price">${{ product.price }}</data>
          </div>

        </div>
      </li>
      
      
    {% empty %}
      <p>Aucun produit trouvé.</p>
    {% endfor %}
  

 <div class="pagination">
  <ul>
    {% if page_obj.has_previous %}
      <li><a href="?page=1">Début</a></li>
      <li><a href="?page={{ page_obj.previous_page_number }}">Précédent</a></li>
    {% endif %}

    <li>Page {{ page_obj.number }} sur {{ page_obj.paginator.num_pages }}</li>

    {% if page_obj.has_next %}
      <li><a href="?page={{ page_obj.next_page_number }}">Suivant</a></li>
      <li><a href="?page={{ page_obj.paginator.num_pages }}">Fin</a></li>
    {% endif %}
  </ul>
</div>


  
       
      

           

      

  

  
</section>










<!-- 
  - #CTA
-->
<section class="section cta">
  <div class="container">
    <ul class="cta-list">
      <li>
        <div class="cta-card" style="background-image: url('{% static "shop/media/images/cta-1.jpg" %}')">
          <p class="card-subtitle">Chaussures Adidas</p>
          <h3 class="h2 card-title">Les soldes d'été à 50% de réduction</h3>
          <a href="#" class="btn btn-link">
            <span>Achetez maintenant</span>
            <ion-icon name="arrow-forward-outline" aria-hidden="true"></ion-icon>
          </a>
        </div>
      </li>

      <li>
        <div class="cta-card" style="background-image: url('{% static "shop/media/images/cta-2.jpg" %}')">
          <p class="card-subtitle">Chaussures Nike</p>
          <h3 class="h2 card-title">Fais en sorte de rester sportif</h3>
          <a href="#" class="btn btn-link">
            <span>Achetez maintenant</span>
            <ion-icon name="arrow-forward-outline" aria-hidden="true"></ion-icon>
          </a>
        </div>
      </li>
    </ul>
  </div>
</section>

<!-- 
  - #SPECIAL
-->
<section class="section special">
  <div class="container">

    <div class="special-banner" style="background-image: url('{% static "shop/media/images/special-banner.jpg" %}')">
      <h2 class="h3 banner-title">Nouvelle Édition de Tendance</h2>
      <a href="#" class="btn btn-link">
        <span>Explorer tout</span>
        <ion-icon name="arrow-forward-outline" aria-hidden="true"></ion-icon>
      </a>
    </div>

    <div class="special-product">
      <h2 class="h2 section-title">
        <span class="text">Spécial Nike </span>
        <span class="line"></span>
      </h2>

      <ul class="has-scrollbar">

        <li class="product-item">
          <div class="product-card" tabindex="0">
            <figure class="card-banner">
              <img src="{% static 'shop/media/images/product-1.jpg' %}" width="312" height="350" loading="lazy"
                alt="Running Sneaker Shoes" class="image-contain">
              <div class="card-badge">New</div>
              <ul class="card-action-list">
                <li class="card-action-item"><button class="card-action-btn" aria-labelledby="card-label-1"><ion-icon name="cart-outline"></ion-icon></button><div class="card-action-tooltip" id="card-label-1">Add to Cart</div></li>
                <li class="card-action-item"><button class="card-action-btn" aria-labelledby="card-label-2"><ion-icon name="heart-outline"></ion-icon></button><div class="card-action-tooltip" id="card-label-2">Add to Whishlist</div></li>
                <li class="card-action-item"><button class="card-action-btn" aria-labelledby="card-label-3"><ion-icon name="eye-outline"></ion-icon></button><div class="card-action-tooltip" id="card-label-3">Quick View</div></li>
                <li class="card-action-item"><button class="card-action-btn" aria-labelledby="card-label-4"><ion-icon name="repeat-outline"></ion-icon></button><div class="card-action-tooltip" id="card-label-4">Compare</div></li>
              </ul>
            </figure>
            <div class="card-content">
              <div class="card-cat"><a href="#" class="card-cat-link">Hommes</a> / <a href="#" class="card-cat-link">Women</a></div>
              <h3 class="h3 card-title"><a href="#">Chaussures de course</a></h3>
              <data class="card-price" value="180.85"> FCFA180.85</data>
            </div>
          </div>
        </li>

        <li class="product-item">
          <div class="product-card" tabindex="0">
            <figure class="card-banner">
              <img src="{% static 'shop/media/images/product-2.jpg' %}" width="312" height="350" loading="lazy"
                alt="Leather Mens Slipper" class="image-contain">
              <ul class="card-action-list">
                <li class="card-action-item"><button class="card-action-btn" aria-labelledby="card-label-1"><ion-icon name="cart-outline"></ion-icon></button><div class="card-action-tooltip" id="card-label-1">Add to Cart</div></li>
                <li class="card-action-item"><button class="card-action-btn" aria-labelledby="card-label-2"><ion-icon name="heart-outline"></ion-icon></button><div class="card-action-tooltip" id="card-label-2">Add to Whishlist</div></li>
                <li class="card-action-item"><button class="card-action-btn" aria-labelledby="card-label-3"><ion-icon name="eye-outline"></ion-icon></button><div class="card-action-tooltip" id="card-label-3">Quick View</div></li>
                <li class="card-action-item"><button class="card-action-btn" aria-labelledby="card-label-4"><ion-icon name="repeat-outline"></ion-icon></button><div class="card-action-tooltip" id="card-label-4">Compare</div></li>
              </ul>
            </figure>
            <div class="card-content">
              <div class="card-cat"><a href="#" class="card-cat-link">Hommes</a> / <a href="#" class="card-cat-link">Sports</a></div>
              <h3 class="h3 card-title"><a href="#">Chaussons en cuir pour hommes</a></h3>
              <data class="card-price" value="190.85"> FCFA190.85</data>
            </div>
          </div>
        </li>

        <li class="product-item">
          <div class="product-card" tabindex="0">
            <figure class="card-banner">
              <img src="{% static 'shop/media/images/product-3.jpg' %}" width="312" height="350" loading="lazy"
                alt="Simple Fabric Shoe" class="image-contain">
              <div class="card-badge">Nouveau</div>
              <ul class="card-action-list">
                <li class="card-action-item"><button class="card-action-btn" aria-labelledby="card-label-1"><ion-icon name="cart-outline"></ion-icon></button><div class="card-action-tooltip" id="card-label-1">Add to Cart</div></li>
                <li class="card-action-item"><button class="card-action-btn" aria-labelledby="card-label-2"><ion-icon name="heart-outline"></ion-icon></button><div class="card-action-tooltip" id="card-label-2">Add to Whishlist</div></li>
                <li class="card-action-item"><button class="card-action-btn" aria-labelledby="card-label-3"><ion-icon name="eye-outline"></ion-icon></button><div class="card-action-tooltip" id="card-label-3">Quick View</div></li>
                <li class="card-action-item"><button class="card-action-btn" aria-labelledby="card-label-4"><ion-icon name="repeat-outline"></ion-icon></button><div class="card-action-tooltip" id="card-label-4">Compare</div></li>
              </ul>
            </figure>
            <div class="card-content">
              <div class="card-cat"><a href="#" class="card-cat-link">Hommes</a> / <a href="#" class="card-cat-link">Femmes</a></div>
              <h3 class="h3 card-title"><a href="#">Chaussure en tissu simple</a></h3>
              <data class="card-price" value="160.85"> FCFA160.85</data>
            </div>
          </div>
        </li>

        <li class="product-item">
          <div class="product-card" tabindex="0">
            <figure class="card-banner">
              <img src="{% static 'shop/media/images/product-4.jpg' %}" width="312" height="350" loading="lazy"
                alt="Air Jordan 7 Retro " class="image-contain">
              <div class="card-badge"> -25%</div>
              <ul class="card-action-list">
                <li class="card-action-item"><button class="card-action-btn" aria-labelledby="card-label-1"><ion-icon name="cart-outline"></ion-icon></button><div class="card-action-tooltip" id="card-label-1">Add to Cart</div></li>
                <li class="card-action-item"><button class="card-action-btn" aria-labelledby="card-label-2"><ion-icon name="heart-outline"></ion-icon></button><div class="card-action-tooltip" id="card-label-2">Add to Whishlist</div></li>
                <li class="card-action-item"><button class="card-action-btn" aria-labelledby="card-label-3"><ion-icon name="eye-outline"></ion-icon></button><div class="card-action-tooltip" id="card-label-3">Quick View</div></li>
                <li class="card-action-item"><button class="card-action-btn" aria-labelledby="card-label-4"><ion-icon name="repeat-outline"></ion-icon></button><div class="card-action-tooltip" id="card-label-4">Compare</div></li>
              </ul>
            </figure>
            <div class="card-content">
              <div class="card-cat"><a href="#" class="card-cat-link">Hommes</a> / <a href="#" class="card-cat-link">Sports</a></div>
              <h3 class="h3 card-title"><a href="#">Air Jordan 7 Rétro</a></h3>
              <data class="card-price" value=" FCFA170.85 <del> FCFA200.21</del></data>
            </div>
          </div>
        </li>

      </ul>
    </div>
  </div>
</section>








<!-- 
  - #SERVICE
-->

<section class="section service">
  <div class="container">

    <ul class="service-list">

      <li class="service-item">
        <div class="service-card">

          <div class="card-icon">
            <img src="{% static 'shop/media/images/service-1.png' %}" width="53" height="28" loading="lazy" alt="Service icon">
          </div>

          <div>
            <h3 class="h4 card-title">Livraison gratuite</h3>

            <p class="card-text">
              Toutes les commandes supérieures à<span>$150</span>
            </p>
          </div>

        </div>
      </li>

      <li class="service-item">
        <div class="service-card">

          <div class="card-icon">
            <img src="{% static 'shop/media/images/service-2.png' %}" width="43" height="35" loading="lazy" alt="Service icon">
          </div>

          <div>
            <h3 class="h4 card-title">Paiement rapide</h3>

            <p class="card-text">
              Paiement 100% sécurisé
            </p>
          </div>

        </div>
      </li>

      <li class="service-item">
        <div class="service-card">

          <div class="card-icon">
            <img src="{% static 'shop/media/images/service-3.png' %}" width="40" height="40" loading="lazy" alt="Service icon">
          </div>

          <div>
            <h3 class="h4 card-title">Retours gratuits</h3>

            <p class="card-text">
              Remboursement sous 30 jours
            </p>
          </div>

        </div>
      </li>

      <li class="service-item">
        <div class="service-card">

          <div class="card-icon">
            <img src="{% static 'shop/media/images/service-4.png' %}" width="40" height="40" loading="lazy" alt="Service icon">
          </div>

          <div>
            <h3 class="h4 card-title">Support 24/7</h3>

            <p class="card-text">
              Obtenez un support rapide
            </p>
          </div>

        </div>
      </li>

    </ul>

  </div>
</section>

<!-- 
  - #INSTA POST
-->

<section class="section insta-post">

  <ul class="insta-post-list has-scrollbar">

    <li class="insta-post-item">
      <img src="{% static 'shop/media/images/insta-1.jpg' %}" width="100" height="100" loading="lazy" alt="Instagram post"
        class="insta-post-banner image-contain">

      <a href="#" class="insta-post-link">
        <ion-icon name="logo-instagram"></ion-icon>
      </a>
    </li>

    <li class="insta-post-item">
      <img src="{% static 'shop/media/images/insta-2.jpg' %}" width="100" height="100" loading="lazy" alt="Instagram post"
        class="insta-post-banner image-contain">

      <a href="#" class="insta-post-link">
        <ion-icon name="logo-instagram"></ion-icon>
      </a>
    </li>

    <li class="insta-post-item">
      <img src="{% static 'shop/media/images/insta-3.jpg' %}" width="100" height="100" loading="lazy" alt="Instagram post"
        class="insta-post-banner image-contain">

      <a href="#" class="insta-post-link">
        <ion-icon name="logo-instagram"></ion-icon>
      </a>
    </li>

    <li class="insta-post-item">
      <img src="{% static 'shop/media/images/insta-4.jpg' %}" width="100" height="100" loading="lazy" alt="Instagram post"
        class="insta-post-banner image-contain">

      <a href="#" class="insta-post-link">
        <ion-icon name="logo-instagram"></ion-icon>
      </a>
    </li>

    <li class="insta-post-item">
      <img src="{% static 'shop/media/images/insta-5.jpg' %}" width="100" height="100" loading="lazy" alt="Instagram post"
        class="insta-post-banner image-contain">

      <a href="#" class="insta-post-link">
        <ion-icon name="logo-instagram"></ion-icon>
      </a>
    </li>

    <li class="insta-post-item">
      <img src="{% static 'shop/media/images/insta-6.jpg' %}" width="100" height="100" loading="lazy" alt="Instagram post"
        class="insta-post-banner image-contain">

      <a href="#" class="insta-post-link">
        <ion-icon name="logo-instagram"></ion-icon>
      </a>
    </li>

    <li class="insta-post-item">
      <img src="{% static 'shop/media/images/insta-7.jpg' %}" width="100" height="100" loading="lazy" alt="Instagram post"
        class="insta-post-banner image-contain">

      <a href="#" class="insta-post-link">
        <ion-icon name="logo-instagram"></ion-icon>
      </a>
    </li>

    <li class="insta-post-item">
      <img src="{% static 'shop/media/images/insta-8.jpg' %}" width="100" height="100" loading="lazy" alt="Instagram post"
        class="insta-post-banner image-contain">

      <a href="#" class="insta-post-link">
        <ion-icon name="logo-instagram"></ion-icon>
      </a>
    </li>

  </ul>

</section>

</article>
  <script>

    document.addEventListener('DOMContentLoaded', () => {
      const wishlistButtons = document.querySelectorAll('.card-action-item .wishlist-btn');

      wishlistButtons.forEach(button => {
        button.addEventListener('click', async (e) => {
          e.preventDefault();

          const productId = button.getAttribute('data-product-id');

          try {
            const response = await fetch(`/wishlist/toggle/${productId}/`, {
              method: 'POST',
              headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ product_id: productId }),
            });

            if (!response.ok) throw new Error('Erreur serveur');

            const data = await response.json();

            // data.liked : true ou false selon l’état après toggle
            const icon = button.querySelector('ion-icon');

            if (data.liked) {
              icon.setAttribute('name', 'heart');
              icon.style.color = 'red';
            } else {
              icon.setAttribute('name', 'heart-outline');
              icon.style.color = '';
            }
          } catch (error) {
            alert('Impossible de modifier la wishlist.');
            console.error(error);
          }
        });
      });
    });

    // Fonction pour récupérer le cookie csrf (nécessaire pour POST Django)
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
          cookie = cookie.trim();
          if (cookie.startsWith(name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
  </script>


  
{% endblock %}
